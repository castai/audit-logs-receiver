# Default values for castai-otel-collector.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

image:
  repository: us-docker.pkg.dev/castai-hub/library/audit-logs-receiver
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

replicaCount: 1

# URL to the API server.
apiURL: "https://api.cast.ai"

# API Access Key to be used for authorizing access to the API.
apiKey: ""

# Name of k8s secret with API Access Key.
# apiKey and apiKeySecretRef are mutually exclusive.
# The referenced secret must provide the access key in .data["CASTAI_API_KEY"].
apiKeySecretRef: ""

# Annotations to add to all resources.
commonAnnotations: {}

serviceAccount:
  # Specifies whether a service account should be created.
  create: true
  # Annotations to add to the service account.
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template.
  name: ""

# Annotations to be added to pods.
podAnnotations: {}

# Pod security context.
# Ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod
podSecurityContext: {}

# Container security context.
# Ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod
securityContext: {}

# Resource limits & requests.
resources: {}

# Pod node selector rules.
# Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/
nodeSelector: {}

# Pod toleration rules.
# Ref: https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/
tolerations: []

# Pod affinity rules.
# Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity
affinity: {}

rollout:
  rollingUpdate: {}
  strategy: RollingUpdate

configMap:
  # Specifies whether a configMap should be created (true by default).
  create: true

# Host networking requested for this pod. Use the host's network namespace.
hostNetwork: false

## Persist collector state to a persistent volume.
persistence:
  enabled: true
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 50M
  annotations: {}

statefulset:
  podManagementPolicy: "Parallel"

## OpenTelemetry Collector configuration.
## Ref: https://opentelemetry.io/docs/collector/configuration/
config:
  receivers:
    castai-audit-logs:
      api:
        url:             ${env:CASTAI_API_URL} # Use CASTAI_API_URL env variable to override default API URL (https://api.cast.ai/).
        key:             ${env:CASTAI_API_KEY} # Use CASTAI_API_KEY env variable to provide API Access Key.
      poll_interval_sec: 10 # This parameter defines poll cycle in seconds.
      page_limit:        100 # This parameter defines the max number of records returned from the backend in one page.
      storage:
        type: "persistent"
        filename: "/var/lib/otelcol/file_storage/audit_logs_poll_data.json"

  exporters:
    logging:
      verbosity: detailed
      sampling_initial: 5
      sampling_thereafter: 200

  extensions:
    # The health_check extension is mandatory for this chart.
    # Without the health_check extension the collector will fail the readiness and liveliness probes.
    # The health_check extension can be modified, but should never be removed.
    health_check: {}

  service:
    extensions: [health_check]
    telemetry:
      logs:
        level: "debug"
    pipelines:
      logs:
        receivers: [castai-audit-logs]
        exporters: [logging]
